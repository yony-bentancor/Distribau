<!DOCTYPE html>
<html>
<head>
  <title>Órdenes de trabajo</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background: #f5f6fa;
    }
    .usuario {
      background: white;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h2 {
      margin-bottom: 0.5rem;
    }
    .bodega, .actividades {
      margin-top: 1rem;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      margin-bottom: 0.3rem;
    }
    .actividad {
      border-top: 1px solid #ddd;
      padding-top: 0.5rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Órdenes de trabajo y bodegas</h1>

  <% resultados.forEach(({ usuario, bodega, actividades }) => { %>
    <div class="usuario">
      <h2><%= usuario.username %></h2>

      <div class="bodega">
        <strong>Bodega:</strong>
        <% if (bodega.length > 0) { %>
          <ul>
            <% bodega.forEach(item => { %>
              <li><%= item.componente?.nombre || "Componente eliminado" %> - Cantidad: <%= item.cantidad %></li>
            <% }) %>
          </ul>
        <% } else { %>
          <p>Sin componentes</p>
        <% } %>
      </div>

      <div class="actividades">
        <strong>Actividades:</strong>
        <% if (actividades.length > 0) { %>
          <% actividades.forEach(act => { %>
            <div class="actividad">
              <p><strong>Fecha:</strong> <%= new Date(act.fecha).toLocaleDateString() %></p>
              <p><strong>Tipo:</strong> <%= act.tipo %> | <strong>Estado:</strong> <%= act.estado %></p>
              <ul>
                <% act.componentesUsados.forEach(c => { %>
                  <li><%= c.componente?.nombre || "Componente eliminado" %> - <%= c.cantidad %> unidad/es</li>
                <% }) %>
              </ul>
            </div>
          <% }) %>
        <% } else { %>
          <p>Sin actividades registradas</p>
        <% } %>
      </div>
    </div>
  <% }) %>
</body>
</html>
